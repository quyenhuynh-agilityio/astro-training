---
import BaseLayout from '@layouts/BaseLayout/index.astro';
import Hero from '@sections/HeroSection/index.astro';
import AboutSection from '@sections/AboutSection/index.astro';
import PropertySection from '@sections/PropertySection';
import Footer from '@layouts/Footer';
import TestimonialSection from '@sections/TestimonialSection/index.astro';
import AgentSection from '@sections/AgentSection/index.astro';
import type { HomePageType } from '@types-local/home';
import { loadQuery } from 'studio/lib/load-query';

const { data: homePage } = await loadQuery<HomePageType>({
  query: `*[_type == "homePage"][0] {
    hero {
      heading {
        title,
        subtitle,
        alignment
      },
      image { asset, alt },
      ctaText,
      ctaLink
    },
    header {
      logo { asset-> { url }, alt },
      navItems[] { title, link },
      ctaText,
      ctaLink
    },
    about {
      title,        
      description,
      image { asset-> { url }, alt },
      ctaText,
      ctaLink
    },
    properties {
      heading { title[], subtitle[], alignment },
      items[]-> {
        title,
        slug,
        details { beds, baths, area },
        mainImage { asset-> { url }, alt }
      },
      filters,
      introText[]
    },
    feature {
      title,
      description,
      image { asset-> { url }, alt },
      ctaText,
      ctaLink
    },
    agent {
      title[],
      description[],
      ctaText,
      ctaLink
    },
    testimonial {
      heading { title[], subtitle[], alignment },
      testimonials[] {
        author,
        role,
        image { asset-> { url }, alt },
        quote[]
      },
      ctaText,
      ctaLink
    },
    footer {
      logo { asset-> { url }, alt },
      links[] { title, links },
      socialLinks[] {
        url,
        icon { asset-> { url }, alt }
      },
      ctaText,
      ctaLink
    }
  }`,
});

if (!homePage) {
  return Astro.redirect('/404');
}

const { header, hero, about, properties, feature, agent, testimonial, footer } =
  homePage;
---

<BaseLayout title="Home Page">
  <Hero
    title={hero.heading.title}
    subtitle={hero.heading.subtitle}
    labelBtn={hero.ctaText}
    logo={header.logo}
    navItems={header.navItems}
    ctaText={header.ctaText}
    image={hero.image}
  />
  <AboutSection
    title={about.title}
    description={about.description}
    image={about.image}
    buttonText={about.ctaText}
  />
  <AgentSection
    title={agent?.title}
    description={agent?.description}
    cta={agent?.ctaText}
    client:load
  />
  <AboutSection
    reverse
    title={feature.title}
    description={feature.description}
    image={feature.image}
    buttonText={feature.ctaText}
  />
  <TestimonialSection
    testimonials={(testimonial?.testimonials || []).map((t: any) => ({
      name: t.author,
      role: t.role,
      image: t?.image,
      quote: t.quote,
    }))}
  />
</BaseLayout>
