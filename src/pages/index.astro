---
import BaseLayout from '@layouts/BaseLayout/index.astro';
import Hero from '@sections/HeroSection/index.astro';
import AboutSection from '@sections/AboutSection/index.astro';
import PropertySection from '@sections/PropertySection/index.astro';
import Footer from '@layouts/Footer/index.astro';
import TestimonialSection from '@sections/TestimonialSection/index.astro';
import AgentSection from '@sections/AgentSection/index.astro';
import type { HomePageType } from '@types-local/home';
import { loadQuery } from 'studio/lib/load-query';
import { homePageQuery } from '@queries/index';

let homePage: HomePageType | null = null;

try {
  const { data } = await loadQuery<HomePageType>({
    query: homePageQuery,
  });
  homePage = data;
} catch (err) {
  console.error('[HomePage] Query failed:', err);
  throw new Response('Internal Server Error', { status: 500 });
}

if (!homePage) {
  throw new Response('Not Found', { status: 404 });
}

const { header, hero, about, properties, feature, agent, testimonial, footer } =
  homePage;
---

<BaseLayout title="Home Page">
  <Hero {hero} {header} />
  <AboutSection {...about} />
  <PropertySection {...properties} />
  <AgentSection {...agent} />
  <AboutSection reverse {...feature} />
  <TestimonialSection {...testimonial} />
  <Footer {...footer} />
</BaseLayout>
