---
import { Icons } from '@components/Icons';
import DetailItem from '@components/DetailItem';
import PortableText from '@components/PortableText/index.astro';
import PortableTextImage from '@components/PortableTextImage/index.astro';

export interface SanityImage {
  asset: {
    url: string;
  };
  alt?: string;
}

export interface PropertyDetails {
  beds: number;
  baths: number;
  area: string;
  garage: number;
  yearBuilt: number;
}

export interface PropertyData {
  _id: string;
  title: string;
  slug: string;
  address?: string;
  price?: number;
  pricePerSqft?: number;
  mainImage: SanityImage;
  galleryImages: SanityImage[];
  details: PropertyDetails;
  description: string;
  features: string[];
  status?: string;
}

interface Props {
  property: PropertyData;
}

const { property } = Astro.props;
---

<section class="bg-gray-50 py-8">
  <div class="max-w-6xl mx-auto px-4">
    <!-- Images -->
    <div class="mb-8 lg:grid lg:grid-cols-3 lg:gap-4">
      <!-- Main Image -->
      <div class="lg:col-span-2">
        <PortableTextImage
          node={property.mainImage}
          class="w-full h-[250px] sm:h-[350px] lg:h-[450px] object-cover rounded-2xl"
        />
      </div>

      <!-- Thumbnails -->
      <div class="mt-4 lg:mt-0">
        <div
          class="flex gap-3 overflow-x-auto sm:grid sm:grid-cols-3 sm:gap-3 lg:grid-cols-1"
        >
          {
            property.galleryImages
              .slice(1, 7)
              .map((image, i) => (
                <PortableTextImage
                  node={image}
                  class="w-32 h-24 sm:w-full sm:h-28 object-cover rounded-xl cursor-pointer flex-shrink-0 hover:opacity-80 transition"
                />
              ))
          }
        </div>
      </div>
    </div>

    <!-- Details -->
    <div class="bg-white rounded-2xl shadow-sm p-6 mb-8">
      <h2 class="text-xl font-semibold mb-6">Details</h2>
      <div
        class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-6 text-center border-t border-accent"
      >
        <DetailItem
          icon={Icons.Bed}
          value={property.details.beds}
          label="Beds"
          bordered
        />
        <DetailItem
          icon={Icons.Shower}
          value={property.details.baths}
          label="Baths"
          bordered
        />
        <DetailItem icon={Icons.Size} value={property.details.area} bordered />
        <DetailItem
          icon={Icons.Garage}
          value={property.details.garage}
          label="Garage"
          bordered
        />
        <DetailItem
          icon={Icons.Bed}
          value={`Built ${property.details.yearBuilt}`}
        />
      </div>
    </div>

    <!-- Description -->
    <div class="bg-white rounded-2xl shadow-sm p-6 mb-8">
      <h2 class="text-xl font-semibold pb-4 border-b border-accent">
        Description
      </h2>
      <div class="text-gray-700 whitespace-pre-line leading-relaxed pt-4">
        <PortableText value={property.description} />
      </div>
    </div>

    <!-- Features -->
    <div class="bg-white rounded-2xl shadow-sm p-6 mb-8">
      <h2 class="text-xl font-semibold py-4 border-b border-accent">
        Features
      </h2>
      <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 mt-4">
        {
          (property.features || []).map((feature) => (
            <div class="flex items-center gap-2 text-gray-700 hover:text-primary transition">
              <Icons.Check />
              <span>{feature}</span>
            </div>
          ))
        }
      </div>
    </div>
  </div>
</section>
