---
import { urlForImage } from '@lib/sanity';
const { node, class: className } = Astro.props;
const asset = node?.asset;

let url = '';
let webpUrl = '';

if (asset?._id || asset?._ref) {
  url = urlForImage(asset).url();
  webpUrl = urlForImage(asset).format('webp').url();
} else if (asset?.url) {
  // fallback if only url exists
  url = asset.url;
}
---

<picture>
  {webpUrl && <source srcset={webpUrl} type="image/webp" />}
  {url && <img class={className} src={url} alt={node?.alt || ''} />}
</picture>
