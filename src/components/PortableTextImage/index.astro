---
import { urlForImage } from '@lib/sanity';

const { node, class: className, sizes } = Astro.props;

const url = node?.asset?.url;
const width = node?.asset?.metadata?.dimensions?.width || 1440;
const height = node?.asset?.metadata?.dimensions?.height || 850;
const defaultSizes = sizes || '(max-width: 640px) 100vw, 100vw';
const webpUrl = url ? urlForImage(node.asset).format('webp').url() : undefined;
---

{
  url && (
    <picture class={className}>
      {webpUrl && (
        <source srcset={webpUrl} type="image/webp" sizes={defaultSizes} />
      )}
      <img
        src={url}
        alt={node?.alt || ''}
        width={width}
        height={height}
        sizes={defaultSizes}
        loading="lazy"
        decoding="async"
        style="object-fit: cover; width: 100%; height: auto;"
      />
    </picture>
  )
}
